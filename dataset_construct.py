import os
import csv
import logging
from data_processing import origin_data_processing
from data_processing import feature_extraction
def count_directories(path):  
    return len([name for name in os.listdir(path) if os.path.isdir(os.path.join(path, name))])  


if __name__ == '__main__':
    logging.basicConfig(filename='./log/dataset_construct.txt',  
                    level=logging.INFO,  
                    format='%(asctime)s - %(levelname)s - %(message)s')
    Malware_or_Benign = 'malware'
    directory_path = ''
    filename = [f for f in os.listdir(directory_path) ] 


    start_index= 0
    total_num = count_directories(directory_path) 
    num = 0 
    
    with open('./dataset/feature_extraction_realworld.csv', 'a', newline='',encoding='utf-8',) as f_csv:
        csv_writer = csv.writer(f_csv,escapechar='\\')
        name = ['name','features','benign','malware']
        #csv_writer.writerow(name)
        for index,file in enumerate(filename):
            if index < start_index:
                continue
            #permission,api,url = origin_data_processing(directory_path+file)
            permission_api,url = feature_extraction(directory_path+file)
            if Malware_or_Benign == 'malware':
                csv_writer.writerow([file,permission_api+" "+url,0,1])
            else:
                csv_writer.writerow([file,permission_api+" "+url,1,0])
            num = num+1
            print(f"[{num}/{total_num}]")
            logging.info(f"[{num}/{total_num}] Processed file: {file}")


    
